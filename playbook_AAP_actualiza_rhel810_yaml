---
- name: Actualizar RHEL 8.x a RHEL 8.10
  hosts: all
  become: true  # Ejecutar como root

  tasks:
    - name: Verificar la versión actual de RHEL
      command: cat /etc/redhat-release
      register: current_version
      changed_when: false

    - name: Mostrar la versión actual antes de actualizar
      debug:
        msg: "Versión actual de RHEL: {{ current_version.stdout }}"

    - name: Habilitar los repositorios necesarios para la actualización
      command: subscription-manager repos --enable=rhel-8-for-x86_64-baseos-rpms --enable=rhel-8-for-x86_64-appstream-rpms
      register: repo_status
      changed_when: "'enabled' in repo_status.stdout"

    - name: Limpiar caché de dnf
      command: dnf clean all

    - name: Actualizar metadatos de paquetes
      command: dnf makecache

    - name: Actualizar el sistema a RHEL 8.10
      command: dnf update -y

    - name: Forzar el reinicio después de la actualización
      reboot:
        reboot_timeout: 600
        test_command: "uptime"
